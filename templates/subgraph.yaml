specVersion: 0.0.2
schema:
  file: ./schema.graphql
dataSources:
  #  {{#each dataSources}}
  - kind: ethereum
    name: TradeTrustERC721
    network: {{network}}
    source:
      abi: TradeTrustERC721
      address: "{{address}}"
      startBlock: {{startBlock}}
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.5
      language: wasm/assemblyscript
      entities:
        - TradeTrustERC721
        - TitleEscrow
      abis:
        - name: TradeTrustERC721
          file: ./node_modules/@govtechsg/token-registry/dist/artifacts/TradeTrustERC721Base.sol/TradeTrustERC721Base.json
        - name: TitleEscrowFactory
          file: ./node_modules/@govtechsg/token-registry/dist/artifacts/TitleEscrowFactory.sol/TitleEscrowFactory.json
        - name: TitleEscrow
          file: ./node_modules/@govtechsg/token-registry/dist/artifacts/TitleEscrow.sol/TitleEscrow.json
      eventHandlers:
        - event: Transfer(indexed address,indexed address,indexed uint256)
          handler: handleTransfer
      file: ./src/main.ts
  #  {{/each}}

templates:
  - kind: ethereum/contract
    name: TitleEscrow
    network: {{network}}
    source:
      abi: TitleEscrow
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.5
      language: wasm/assemblyscript
      file: ./src/escrow.ts
      entities:
        - TitleEscrowCloneable
        - TradeTrustERC721
      abis:
        - name: TitleEscrow
          file: ./node_modules/@govtechsg/token-registry/dist/artifacts/TitleEscrow.sol/TitleEscrow.json
        - name: TitleEscrowFactory
          file: ./node_modules/@govtechsg/token-registry/dist/artifacts/TitleEscrowFactory.sol/TitleEscrowFactory.json
        - name: TradeTrustERC721
          file: ./node_modules/@govtechsg/token-registry/dist/artifacts/TradeTrustERC721Base.sol/TradeTrustERC721Base.json
      eventHandlers:
        - event: Surrender(indexed address,address,uint256)
          handler: handleSurrender
        - event: TokenReceived(indexed address,indexed address,indexed bool,address,uint256)
          handler: handleTokenReceived
        - event: Nomination(indexed address,indexed address,address,uint256)
          handler: handleNomination
        - event: BeneficiaryTransfer(indexed address,indexed address,address,uint256)
          handler: handleBeneficiaryTransfer
        - event: HolderTransfer(indexed address,indexed address,address,uint256)
          handler: handleHolderTransfer
        - event: Shred(address,uint256)
          handler: handleShred
